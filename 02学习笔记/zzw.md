# 数据库
## 1. mysql
### 1.1 设计原则
  + 数据类型按照实际情况，范围或者占用空间更小的通常更好
  + 尽量避免NUll
  + datetime 能存储1001年到9999年，精度为秒。与时区无关，使用8个字节。
  + timestamp 保存1970年至今的秒数，只使用4个字节，范围是1970-2038，显示依赖时区。
  + 满足三大范式：
    + 第一范式：属性不可再分；
    + 第二范式：为了减少冗余，所有列都只和其中一列（主键）相关；如果有和多个列相关的可以拆开多个表；
    
      | 学号 |  姓名  |  专业名 | 专业主任 | 课程名称 | 分数 |
      | ---- |  ----  |  ---- | ---- | ---- | ---- |
      表可以拆为：
      
      | 学号 |   课程名称 | 分数 |
      | ---- | ---- | ---- |
      
      | 学号 |  姓名  |  专业名 | 专业主任 |
      | ---- |  ----  |  ---- | ----  |
    + 第三范式：每列都需要与主键直接相关，不能间接相关
    
      | 学号 |   课程名称 | 分数 |
      | ---- | ---- | ---- |
      
      | 学号 |   姓名 | 专业名 |
      | ---- | ---- | ---- |
      
      | 专业名 | 专业主任 |
      | ---- | ---- |
### 1.2 事务
  + 事务的四个基本特性：
    + 原子性（Atomicity）：一个事务是一个整体，要么全部执行成功，要么都不执行。
    + 一致性（Consistency）：事务执行前后，数据从一个状态到另一个状态必须是一致的（本来应该+，结果出来成-了）。
    + 隔离性（Isolation）：多个并发事务之间相互隔离，一个不影响另一个。
    + 持久性（Durablity）：事务执行完后，对数据库修改是永久的，没法回滚。
  + 事务并发常见问题
    + 脏读：A事务执行过程中，B事务修改了数据，导致A事务读取了修改后的数据，但是B最后又回退了，所以让A读取了错误的数据。
    + 不可重复读：A执行过程中，B修改了数据，导致A前后读取的数据不一致。
    + 幻读：A执行过程中，B增加了数据，导致A前后读取不一致。
  + 针对事务并发隔离的4个级别：MYSQL默认可重复读，设置隔离级别：SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
    + 读未提交：能读到未提交的事务中所做的修改，这种会产生脏读。性能不会好太多，问题很多，很少用。
    + 读已提交：只能获取已经提交事务后的结果，也就是说事务中所做的修改对其他事务是不可见的。解决的脏读问题。
    + 可重复读：读取一个数据前给数据加共享行锁，更新时加排它行锁，这样就避免在事务中数据被其他事务修改，解决了不可重复读问题。
    + 可串行化：加表锁防止事务并行。innodb通过MCVV快照方式解决幻读问题。
  + innodb处理死锁是将持有最少行级拍他锁的事务进行回滚
### 1.3 索引
  + 为什么用b+树
    + 列表等有序数据：数据量大了不能全部加载到内存来查找
    + 二叉树：可以保存树的前几层，但是极端情况，二叉树就和有序列表一样。
    + 平衡二叉树：没法范围查询
    + B树：
      1. 所有节点都存数据，B+树只有叶子节点存数据，读写磁盘B+树就相对能读的节点多；
      2. B树可能在父节点就查到数据，有可能在子节点，查询效率不稳定，B+树每次都需要查询到子节点；
      3. B+树数据都在叶子节点并且相连，分支都是索引，方便扫库，适合范围查询，而B树只能遍历整个树；
  + 最左原则：联合索引创建时索引是按照从左到右的顺序排列的，比如（a, b）则是先按照a排序，a相同时按照b排序。
  比如a>1 and b=4 只有a走索引，因为在a>1的情况下b是无序的。最左原则就是：最左优先，从左边开始任何连续索引能匹配上，遇到范围查询就回停止匹配。
  + 聚簇索引和非聚簇索引：  
    聚集索引：数据和主键聚集在一起，聚簇索引只能有一个，就是表本身的一种排列方式，类似新华字典正文内容本身就是一种按照一定规则排列的目录。  
    非聚集索引：就是主键和数据分离，主键指向数据，索引是纯粹主键的索引，可以有多个，这种目录纯粹是目录，正文纯粹是正文的排序方式。
### 1.4 引擎
  